<section class="card mt-4 p-4 space-y-2">
  <h2 class="text-lg font-display">{{ title }} ({{ count }})</h2>
  <div *ngIf="loading" class="text-aluminium">Carregando...</div>
  <div *ngIf="error" class="text-bauxite">
    Erro ao carregar.
    <button (click)="retry()" class="btn btn-secondary mt-2">Tentar novamente</button>
  </div>
  <div *ngIf="!loading && !error && posts.length === 0" class="text-aluminium">
    Sem {{ title.toLowerCase() }} para este turno.
  </div>
  <article
    *ngFor="let post of posts; trackBy: trackById"
    [attr.id]="'post-' + post.id"
    class="p-3 border border-light-gray rounded-lg shadow-sm" [class.bg-warm]="post.id === highlightId"
    [class.mt-3]="post !== posts[0]"
  >
    <div class="flex justify-between items-start">
      <span class="text-xs font-semibold px-2 py-0.5 rounded" [ngClass]="tagClass()">{{ typeLabel() }}</span>
      <span class="text-xs text-mid-gray">{{ post.author.name }} â€” {{ post.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
    </div>
    <div class="mt-1 prose prose-sm max-w-none" [innerHTML]="post.content" (click)="onContentClick($event)"></div>
    <div *ngIf="post.attachments.length" class="mt-1 flex flex-col gap-1">
      <ng-container *ngFor="let att of post.attachments">
        <img
          *ngIf="att.mimeType.startsWith('image/')"
          [src]="att.url"
          [alt]="att.filename"
          class="max-w-full max-h-96 object-contain border cursor-pointer"
          (click)="openImage(att.url, att.filename)"
        />
        <a
          *ngIf="att.mimeType === 'application/pdf'"
          [href]="att.url"
          target="_blank"
          class="flex items-center text-hydro-blue text-sm underline"
        >
          ðŸ“„ {{ att.filename }}
        </a>
      </ng-container>
    </div>
    <div class="mt-1 flex items-center gap-3 text-sm text-aluminium">
      <button class="text-hydro-blue hover:underline" (click)="thread.toggleComposer()">Responder</button>
      <button class="text-hydro-blue hover:underline" (click)="copyLink(post)">Copiar link</button>
      <button class="text-bauxite hover:underline" (click)="deletePost(post)">Excluir</button>
      <span>{{ post._count.replies }} respostas</span>
      <span>Atualizado {{ post.updatedAt | date:'dd/MM HH:mm' }}</span>
    </div>
    <app-reply-thread #thread [post]="post"></app-reply-thread>
  </article>
  <div *ngIf="!loading && posts.length < count" class="text-center mt-2">
    <button (click)="loadMore()" class="btn bg-light-gray hover:bg-light-gray/80">Carregar mais</button>
  </div>
</section>
<div
  *ngIf="modalImageUrl"
  class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"
  (click)="closeImage()"
>
  <img
    [src]="modalImageUrl"
    [alt]="modalImageAlt"
    class="max-w-[90vw] max-h-[90vh] object-contain"
    (click)="$event.stopPropagation()"
  />
</div>
